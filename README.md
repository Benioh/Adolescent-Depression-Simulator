# 心理健康Agent模拟框架

一个基于大语言模型的心理健康模拟系统，通过多Agent协同展示学生从健康状态逐渐发展为抑郁症的心理过程，并提供完整的心理咨询对话功能。

## 📖 项目概述

本项目通过多个AI智能体（Agent）模拟真实的人际互动环境，展示一个高中生李明在学业压力、人际关系等多重因素影响下，心理健康状况逐步恶化直至患上抑郁症的完整过程。模拟结束后，您可以与保留完整30天记忆的李明进行心理咨询对话，体验真实的心理治疗过程。

## 🎯 主要功能

### 🏥 心理模拟系统
- **多Agent协同**：7个不同性格的AI角色互动
- **心理状态建模**：科学的抑郁症发展模型（5个阶段）
- **动态关系网络**：角色间关系随时间变化
- **真实场景模拟**：学校、家庭等多种环境
- **详细数据记录**：完整的心理变化轨迹，自动保存到子文件夹

### 💬 心理咨询对话系统

#### 🎭 智能患者对话
- **完整记忆**：李明保留30天模拟的所有经历和创伤（支持完整历史数据模式）
- **真实状态**：重度抑郁症的真实表现和症状
- **情绪反应**：基于心理学原理的自然情绪波动
- **青少年特色**：符合17岁高中生的语言和行为
- **多数据源支持**：可从最终报告、单日状态或完整历史数据开始咨询

#### 💡 专业指导系统
- **督导建议**：每3轮对话提供专业咨询技术指导
- **技术评估**：分析咨询师干预的恰当性
- **改进建议**：提供更有效的治疗方向
- **实时反馈**：基于对话质量的动态建议

#### 📝 高级记录管理
- **模拟子文件夹**：每次模拟自动创建独立的 `logs/sim_YYYYMMDD_HHMMSS/` 目录
- **对话自动保存**：完整咨询对话自动保存，包含时间戳和会话信息
- **历史记录查看**：全局扫描和查看所有历史咨询记录
- **多文件支持**：支持从不同数据源（最终报告、单日状态、完整历史）开始咨询

#### 🎛️ 灵活配置系统
- **对话历史长度**：可配置AI记忆的对话轮数（1-20轮，默认20轮）
- **事件显示数量**：可配置患者状态面板显示的重要事件数（1-20个，默认20个）
- **实时调整**：支持在使用过程中动态修改配置
- **个性化设置**：根据咨询需要调整参数

#### 🎓 学习价值
- **技能练习**：安全环境下练习心理咨询技能
- **病理理解**：深入体验抑郁症患者的内心世界
- **发展轨迹**：观察心理问题的完整发展过程
- **共情培养**：提升对青少年心理问题的理解

### 🎬 模拟角色
- **李明**（主角）：17岁高中生，内向敏感，完美主义者
- **李建国**（父亲）：严厉型教育方式的工程师
- **王秀芳**（母亲）：焦虑型性格，情感敏感的会计
- **张老师**：严格的数学老师，期望较高
- **王小明**：主角的最好朋友，忠诚支持
- **刘强**：校园霸凌者，攻击性强
- **陈优秀**：学业竞争对手，成绩优异

## 🏗️ 系统架构

```
mental_health_agent/
├── agents/                    # Agent角色定义
│   ├── base_agent.py         # Agent基类
│   ├── student_agent.py      # 学生主角
│   ├── family_agents.py      # 家庭成员
│   ├── school_agents.py      # 学校人员
│   └── therapist_agent.py    # 心理咨询师督导
├── core/                     # 核心组件
│   ├── gemini_client.py      # Gemini API封装
│   ├── simulation_engine.py  # 模拟引擎
│   └── therapy_session_manager.py  # 咨询会话管理器
├── models/                   # 数据模型
│   └── psychology_models.py  # 心理学模型
├── logs/                     # 日志文件
│   └── sim_YYYYMMDD_HHMMSS/  # 模拟运行子目录
│       ├── final_report.json # 最终模拟报告
│       ├── day_X_state.json  # 每日心理状态
│       └── therapy_*.json    # 咨询对话记录
├── main.py                   # 主程序入口
├── start_therapy_from_logs.py # 心理咨询主程序
└── config.py                 # 配置文件
```

## 📋 系统要求

- Python 3.8+
- Google Gemini API密钥
- 稳定的网络连接
- Rich库（用于美观的终端界面）

## 🚀 快速开始

### 1. 环境准备

```bash
# 克隆项目
git clone https://github.com/Benioh/Adolescent-Depression-Simulator.git
cd mental_health_agent

# 安装依赖
pip install -r requirements.txt
```

### 2. 配置API密钥



 编辑配置文件config.py，添加您的Gemini API密钥
 GEMINI_API_KEY = "your_actual_api_key_here"


**获取Gemini API密钥：**
1. 访问 [Google AI Studio](https://makersuite.google.com/)
2. 创建新项目或选择现有项目
3. 生成API密钥
4. 将密钥复制到 `config.py` 文件中

### 3. 配置参数说明

编辑 `config.py` 中的关键参数：

```python
# 模拟相关参数
SIMULATION_SPEED = 1                    # 模拟速度（秒），控制30天模拟的执行间隔
LOG_LEVEL = "INFO"                     # 日志级别：DEBUG, INFO, WARNING, ERROR
DEPRESSION_DEVELOPMENT_STAGES = 5       # 抑郁发展阶段数（影响心理状态层次性）
INTERACTION_FREQUENCY = 3              # 交互频率（影响事件生成密度）

# 咨询相关参数（可在程序中动态调整）
CONVERSATION_HISTORY_LENGTH = 20        # AI记忆的对话轮数
MAX_EVENTS_TO_SHOW = 20                # 患者状态面板显示的事件数
```

### 4. 使用方式

#### 方式一：完整体验（推荐首次使用）
```bash
python main.py
```
提供完整的功能菜单：
- **选项1**：运行30天心理健康模拟
- **选项2**：与模拟后的李明进行心理咨询对话
- **选项3**：查看现有模拟报告

#### 方式二：心理咨询专用（推荐日常使用）
```bash
python start_therapy_from_logs.py
```
专门的心理咨询界面，支持：
- 选择不同的模拟运行记录
- 选择不同的数据源（最终报告、单日状态、完整历史）
- 配置对话参数
- 查看历史咨询记录

## 💬 心理咨询使用指南

### 🚀 快速开始咨询

1. **首次使用**：先运行 `python main.py` 选择选项1生成模拟数据
2. **日常使用**：运行 `python start_therapy_from_logs.py` 直接开始咨询

### 📊 数据源选择

系统支持三种数据源，各有特点：

#### 1. 完整历史数据（推荐）
- **特点**：整合最终报告 + 30天所有每日事件
- **优势**：李明拥有最丰富的记忆，能引用具体事件
- **适用**：深度心理治疗，创伤探索

#### 2. 最终报告（单独）
- **特点**：基于最终模拟报告的重要事件
- **优势**：聚焦关键问题，避免信息过载
- **适用**：短期咨询，问题聚焦

#### 3. 单日状态
- **特点**：基于特定某一天的心理状态
- **优势**：体验特定阶段的心理状态
- **适用**：阶段性分析，发展轨迹研究

### 🎯 咨询技巧建议

#### 初次接触技巧
```
推荐开场白：
"你好李明，我是心理咨询师。我想先了解一下，你现在感觉怎么样？"

注意事项：
- 温和问候，建立安全感
- 不要过于急于探索创伤
- 关注当下感受和情绪
```

#### 深入探索技巧
```
有效问题示例：
"你提到被同学疏远，那时你内心是什么感受？"
"当这些事情发生时，你觉得最难受的是什么？"
"能告诉我更多关于...的情况吗？"

技巧要点：
- 使用开放性问题
- 反映感受和情绪
- 避免说教和建议
- 保持耐心和共情
```

#### ⚠️ 重要注意事项
- 李明可能会有自伤念头，需要评估风险
- 避免过度追问创伤细节
- 注意维护治疗关系的边界
- 如遇危机情况，及时寻求专业帮助

### 🔧 系统功能详解

#### 专业督导系统
- **智能触发**：根据设置的督导间隔自动提供（默认每3轮）
- **上下文分析**：分析最近N轮对话（N=督导间隔），确保分析深度与频率匹配
- **五维分析**：
  - 当前干预评估：技术恰当性、时机把握
  - 患者反应深层分析：结合背景的心理动力分析
  - 治疗进程评估：关系建立、信任发展
  - 专业改进建议：具体可行的技术建议
  - 风险评估：安全性和注意事项
- **动态调整**：可在咨询中实时修改督导频率和分析深度

#### 配置管理
在程序中输入 `s` 进入设置菜单：

**咨询设置：**
- **对话历史长度**：5-50轮可选，影响AI记忆深度和上下文理解
- **事件显示数量**：3-30个可选，影响患者状态面板信息量

**督导设置：**
- **启用督导**：可开启/关闭AI督导功能
- **督导间隔**：1-10轮可选，控制督导分析频率
- **分析深度**：BASIC/STANDARD/COMPREHENSIVE，控制督导详细程度

**特点：**
- **实时生效**：设置修改对当前会话立即生效
- **动态调整**：可在咨询过程中随时调整
- **智能分析**：督导会分析最近N轮对话（N=督导间隔）

#### 历史记录管理
在程序中输入 `v` 查看：
- **全局扫描**：自动扫描所有模拟和咨询记录
- **详细信息**：显示会话ID、数据源、时间等
- **便于追踪**：方便研究和学习回顾

### 📝 对话记录

所有咨询对话自动保存到：
```
logs/sim_YYYYMMDD_HHMMSS/therapy_*.json
```

记录内容包括：
- 完整对话内容
- 时间戳信息
- 患者背景数据
- 会话元信息

### 🎮 退出对话

输入以下任一命令结束对话：
- `quit` / `exit` / `q`
- `退出`

系统会自动保存对话记录并提供保存路径。

## 📊 心理模拟过程

### 发展阶段（30天模拟）

1. **健康阶段**（第1-6天）
   - 正常的学习生活
   - 与朋友愉快互动
   - 家庭关系和谐

2. **压力积累**（第7-12天）
   - 学业成绩下降
   - 父母开始担心
   - 压力逐渐增加

3. **初期问题**（第13-18天）
   - 同学开始疏远
   - 老师批评增多
   - 自信心下降

4. **关系恶化**（第19-24天）
   - 遭受校园霸凌
   - 家庭冲突加剧
   - 社交回避行为

5. **抑郁发展**（第25-30天）
   - 明显抑郁症状
   - 极度孤独感
   - 学习能力严重下降

### 心理指标监测

- **情绪状态**：开心、中性、焦虑、悲伤、抑郁等
- **抑郁程度**：健康、轻度风险、中度、重度、严重
- **压力水平**：0-10分量表
- **自尊水平**：0-10分量表
- **社交连接**：0-10分量表
- **学业压力**：0-10分量表

## 📈 输出结果

### 模拟子目录结构
```
logs/sim_YYYYMMDD_HHMMSS/
├── final_report.json          # 完整模拟报告
├── day_1_state.json          # 第1天心理状态
├── day_2_state.json          # 第2天心理状态
├── ...
├── day_30_state.json         # 第30天心理状态
└── therapy_session_*.json    # 咨询对话记录
```

### 报告内容
- **模拟过程总结**：30天完整发展轨迹
- **主角心理变化**：详细的心理状态演变
- **抑郁症状分析**：症状发展和严重程度
- **风险因素识别**：导致问题的关键因素
- **关系网络变化**：社交关系的演变过程
- **AI专业分析**：基于心理学理论的深度分析

## 📊 样例咨询对话

```
咨询师：你好李明，我是心理咨询师。你现在感觉怎么样？

李明：（低着头）...不太好吧。每天都觉得很累，什么都不想做。

咨询师：听起来你很疲惫。能告诉我最近发生了什么吗？

李明：（沉默片刻）...就是学校的事。同学们都不跟我说话了，
刘强老是在班上嘲笑我...我觉得都是我的错。

咨询师：你说"都是你的错"，能详细说说为什么这样想吗？

李明：（眼眶有些红）因为...因为我太没用了吧。考试考不好，
也不会和人相处，连朋友都留不住...我就是个失败者。

💡 督导建议：
很好地反映了患者的情感，建议继续探索"都是我的错"这种
自我责备的认知模式，可以尝试认知重构技术。
```

## 🔧 高级配置

### 修改角色属性

编辑 `core/simulation_engine.py` 中的 `setup_simulation()` 方法：

```python
# 修改主角性格
self.protagonist = StudentAgent(
    name="李明",
    age=17,
    personality={
        "traits": ["外向", "乐观", "坚强"],  # 修改性格特征
        "neuroticism": 3  # 降低神经质水平
    },
    gemini_client=self.gemini_client
)
```

### 自定义督导频率

**方法一：修改config.py默认设置**
```python
# config.py
ENABLE_SUPERVISION = True              # 是否启用AI督导功能
SUPERVISION_INTERVAL = 3               # 督导间隔（每N轮对话触发一次督导）
SUPERVISION_ANALYSIS_DEPTH = "COMPREHENSIVE"  # 督导分析深度
```

**方法二：在咨询中动态调整**
在咨询过程中输入 `s` 进入设置菜单，可实时修改：
- 督导开关（启用/禁用）
- 督导间隔（1-10轮）
- 分析深度（BASIC/STANDARD/COMPREHENSIVE）

**方法三：程序启动时指定**
```python
await manager.start_interactive_session(
    provide_supervision=True,
    supervision_interval=5  # 每5轮提供一次督导
)
```

## 🚨 重要提醒

- **模拟性质**：这是AI模拟，仅用于学习和研究
- **专业咨询**：真实心理咨询需要专业心理医师
- **寻求帮助**：如遇到类似现实情况，请寻求专业帮助
- **危机干预**：全国心理危机干预热线：400-161-9995


## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🙏 致谢

- Google Gemini API 提供强大的AI能力
- Rich库提供美观的终端界面
- 心理学研究为模拟提供理论基础

---

**祝您使用愉快！希望这个系统能帮助您更好地理解心理健康工作。** 🧠💚

**如有问题或建议，欢迎提交Issue或联系开发者。**
